# 接口请求规范

## admin 
```java
	@Autowired
    private LocalProperties localProperties;
	

	String url = localProperties.getApiV2Domain() + "/keyword/refreshMapCache.do";
	Map<String, Object> signMap = new HashMap<>();
	com.alibaba.fastjson.JSONObject jsonObject = HttpUtil.getBodyStringForApiV2(url,SignUtil.requestMapBasicSign(signMap),3000);

	if(jsonObject != null){
	 String code = jsonObject.getString("code");
	 if (HttpStatus.SC_OK == Integer.valueOf(code)) {
		 return Boolean.TRUE;
	 }else {
		 return Boolean.FALSE;
	 }
	}else{
	return Boolean.FALSE;
	}
```


## api-v2		 
	// 签名 不为空，说明是后端请求，验证签名正确性
	if(!SignUtil.checkRequest(request)){
		return ServerResponse.createByError(-101, "签名错误");
	}
	
# 缓存建立规范

## 需要oss 和 redis 双重缓存

```java 
public PageResult<TemplateSearchInfoTupleDo> getKeyWordMap(String mapKind,Integer pageNo) {
        // 获取需要获取的分页数据的 文件名称
        String redisKey = null;
        String ossFileKey = null;

        // 获取OSS 中文件的最新更新时间
        if("-1".equals(mapKind)){
            ossFileKey =  pageNo + ".json";
        }else{
            ossFileKey =  mapKind +  "_" + pageNo + ".json";
        }

        ObjectMetadata objMetaData = publicFileStorage.getObjectMetadata(StorageBtype.TEMPLATE_KEYWORD_MAP.getAttachFinalKey(ossFileKey));
        PageResult<TemplateSearchInfoTupleDo> pageResult = new PageResult<>();
        pageResult.setList(new ArrayList<>());
        if(objMetaData == null){
            return pageResult;
        }

        Date lastModified = objMetaData.getLastModified();
        if("-1".equals(mapKind)){
            redisKey = RedisKeyConst.System.TEMPLATE_KEYWORD_MAP + "_"+ pageNo + "_" + lastModified.getTime();
        }else{
            redisKey = RedisKeyConst.System.TEMPLATE_KEYWORD_MAP + "_"+ mapKind + "_" + pageNo + "_" + lastModified.getTime();
        }

        //  先从redis 获取数据
        ICache templateCache = cacheDef.getSYS_CACHE();
        String pageResultStr  = templateCache.get(redisKey);


        if(StringUtils.isNotEmpty(pageResultStr)){
             pageResult = JSONObject.parseObject(pageResultStr,PageResult.class);
        }else{
            // redis 无数据，从oss中获取
            OSSObject file = publicFileStorage.getFile(StorageBtype.TEMPLATE_KEYWORD_MAP.getAttachFinalKey(ossFileKey));
            try(InputStream pageResultIs = file.getObjectContent();){
                if(pageResultIs == null){
                    pageResult = new PageResult<>();
                }else {
                    pageResultStr = StreamUtil.inputStreamToString(pageResultIs);
                    pageResult = JSONObject.parseObject(pageResultStr,PageResult.class);
                }

            }catch (Exception e){
                logger.error("获取模板关键词分页信息失败,类型：{},页码：{}",mapKind,pageNo);
            }
        }

        // 存入redis 中，有的话，就延时 30分钟
        templateCache.set(redisKey,pageResultStr, Expire.m30);
        return pageResult;
    }
```

# service 编写
	ServerResponse getVideoKind(Integer forTest); 
	尽量使用对象形式，少用ServerResponse
	示例：List<VideoKindDo> getVideoKind(Integer forTest); 



